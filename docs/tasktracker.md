# Task Tracker

Отслеживание статуса выполнения задач проекта.

## Задача: Инициализация проекта и настройка Backend

- **Статус**: Завершена
- **Описание**: Создание базовой структуры проекта, настройка backend с NestJS, Prisma и PostgreSQL
- **Шаги выполнения**:
  - [x] Инициализация Git репозитория
  - [x] Создание базовой структуры папок
  - [x] Настройка Docker Compose для PostgreSQL
  - [x] Создание базовой документации
  - [x] Инициализация NestJS проекта
  - [x] Настройка Prisma ORM (v7 с adapter)
  - [x] Создание базовой схемы БД (User, Workspace, WorkspaceUser)
  - [x] Создание модуля Users (Controller, Service, DTO)
  - [x] Настройка валидации данных
  - [x] Тестирование API endpoints
- **Зависимости**: Нет

## Задача: Безопасность и хэширование паролей

- **Статус**: Завершена
- **Описание**: Добавление хэширования паролей с помощью bcrypt для безопасности
- **Шаги выполнения**:
  - [x] Установка bcrypt
  - [x] Создание утилиты для хэширования паролей
  - [x] Обновление UsersService для хэширования при создании
  - [x] Обновление UsersService для хэширования при обновлении пароля
  - [x] Тестирование
- **Зависимости**: Модуль Users должен быть готов

## Задача: Аутентификация и авторизация (JWT)

- **Статус**: Завершена
- **Описание**: Добавление системы аутентификации с JWT токенами для защиты API
- **Шаги выполнения**:
  - [x] Установка зависимостей (@nestjs/jwt, @nestjs/passport, passport, passport-jwt)
  - [x] Создание модуля Auth
  - [x] Создание DTO для login (LoginDto)
  - [x] Создание AuthService (методы login, validateUser)
  - [x] Настройка JWT модуля (JwtModule)
  - [x] Создание JWT стратегии (JwtStrategy)
  - [x] Создание AuthController (endpoint POST /auth/login)
  - [x] Создание JWT Guard для защиты endpoints
  - [x] Создание декоратора @CurrentUser для получения текущего пользователя
  - [x] Защита endpoints Users (добавить @UseGuards(JwtAuthGuard))
  - [x] Типизация всех компонентов (убраны any, as)
  - [x] Тестирование через Postman
- **Зависимости**: Модуль Users и хэширование паролей

## Задача: Модуль Workspaces

- **Статус**: Завершена
- **Описание**: Создание модуля для управления рабочими пространствами (строительными проектами)
- **Шаги выполнения**:
  - [x] Создание WorkspacesController (CRUD endpoints)
  - [x] Создание WorkspacesService (бизнес-логика)
  - [x] Создание DTO для Workspace (CreateWorkspaceDto, UpdateWorkspaceDto)
  - [x] Реализация связи с пользователями (WorkspaceUser)
  - [x] Добавление проверки прав доступа (роли)
  - [x] Тестирование API endpoints
  - [x] Добавление Swagger документации
- **Зависимости**: Модуль Auth и Users

## Задача: Swagger документация

- **Статус**: Завершена
- **Описание**: Настройка Swagger для интерактивной документации и тестирования API
- **Шаги выполнения**:
  - [x] Установка @nestjs/swagger
  - [x] Настройка SwaggerModule в main.ts
  - [x] Добавление декораторов к контроллерам (@ApiTags, @ApiOperation, @ApiResponse)
  - [x] Добавление декораторов к DTO (@ApiProperty)
  - [x] Настройка JWT авторизации в Swagger
  - [x] Тестирование в Swagger UI
- **Зависимости**: Все модули должны быть готовы

## Задача: Refresh Token и Logout

- **Статус**: Завершена
- **Описание**: Добавление refresh token механизма и logout функциональности
- **Шаги выполнения**:
  - [x] Добавление поля refreshToken в модель User
  - [x] Обновление AuthService для генерации refresh token
  - [x] Создание метода refresh() для обновления access token
  - [x] Создание метода logout() для удаления refresh token
  - [x] Добавление endpoints POST /auth/refresh и POST /auth/logout
  - [x] Обновление типов и DTO
  - [x] Исправление HTTP кодов ошибок (401 вместо 500)
- **Зависимости**: Модуль Auth

## Задача: AdminJS интеграция

- **Статус**: Отменена
- **Описание**: Добавление AdminJS для управления пользователями и данными через веб-интерфейс
- **Причина отмены**: AdminJS работает только с CommonJS, и не удалось создать нормальную обертку для использования в проекте с TypeScript и ES modules. Решено не использовать AdminJS в проекте.
- **Альтернатива**: Административные функции будут реализованы через основной frontend приложение с соответствующими правами доступа для роли ADMIN.

## Задача: Инициализация Frontend

- **Статус**: В процессе
- **Описание**: Создание React приложения с TypeScript и настройка базовой структуры
- **Шаги выполнения**:
  - [x] Инициализация React проекта (Vite + TypeScript)
  - [x] Настройка TypeScript
  - [x] Настройка TanStack Router
  - [x] Установка Zustand (готов к использованию)
  - [x] Настройка Tailwind CSS и базовая настройка для ShadCN
  - [x] Создание базовой структуры FSD
  - [ ] Добавление компонентов ShadCN UI
  - [ ] Настройка Zustand stores
- **Зависимости**: Backend API должен быть готов

## Задача: Деплой на Railway

- **Статус**: В процессе
- **Описание**: Настройка автоматического деплоя приложения на Railway из GitHub
- **Шаги выполнения**:
  - [x] Создание проекта на Railway из GitHub-репозитория
  - [x] Добавление PostgreSQL как отдельного сервиса
  - [x] Настройка `build`, `start`, `preinstall` скриптов
  - [x] Исправление порядка сборки (prisma generate до nest build)
  - [x] Отделение typecheck от build (Vite не нуждается в tsc)
  - [x] Создание seed-скрипта для начальных пользователей
  - [ ] Настройка переменных окружения (DATABASE_URL, JWT_SECRET, JWT_REFRESH_SECRET, NODE_ENV)
  - [ ] Успешный деплой и проверка работоспособности
  - [ ] Проверка логина через дефолтных пользователей
- **Зависимости**: Все модули backend и frontend

## Задача: Рефакторинг Table Widget

- **Статус**: Не начата
- **Описание**: Рефакторинг виджета DataTable — текущая реализация взята из reference и адаптирована наспех, содержит TypeScript-ошибки. Папки `widgets/table`, `features/estimates`, `entities/estimates` временно исключены из typecheck.
- **Шаги выполнения**:
  - [ ] Ревью текущего кода DataTableEnhanced и связанных компонентов
  - [ ] Исправление TypeScript-ошибок (30 ошибок: unused vars, type mismatches)
  - [ ] Рефакторинг в соответствии с FSD-архитектурой
  - [ ] Возврат `widgets/table`, `features/estimates`, `entities/estimates` в typecheck
  - [ ] Проверка `pnpm run typecheck` без ошибок
- **Зависимости**: Нет

## Задача: Настройка API клиента и TanStack Query

- **Статус**: Завершена
- **Описание**: Создание axios клиента и TanStack Query client с обработкой ошибок
- **Шаги выполнения**:
  - [x] Установка @tanstack/react-query, axios, @tanstack/react-query-devtools
  - [x] Создание axios клиента с интерцепторами:
    - [x] Автоматическое добавление JWT токенов в заголовки
    - [x] Обработка ошибок и добавление метаданных
    - [x] Поддержка структурированных ошибок от бэкенда
  - [x] Создание TanStack Query client с обработкой ошибок:
    - [x] Централизованная обработка ошибок
    - [x] Логирование детальной информации об ошибках
    - [x] Подготовка к интеграции аналитики
  - [x] Добавление ReactQueryDevtools для dev режима
  - [x] Обновление App.tsx: добавление QueryClientProvider
  - [x] Создание документации модуля API
- **Зависимости**: Backend API должен быть готов


